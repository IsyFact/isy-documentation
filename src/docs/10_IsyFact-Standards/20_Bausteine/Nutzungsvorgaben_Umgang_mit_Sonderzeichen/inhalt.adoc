= Nutzungsvorgaben Umgang mit Sonderzeichen: Inhalt

// tag::inhalt[]
[[konfigurationseinstellungen-fuer-den-zeichensatz]]
== Konfigurationseinstellungen für den Zeichensatz

Im Folgenden wird die Konfiguration der technischen Systeme zur Verwendung des Zeichensatzes erläutert.
Um zu erreichen, dass jedes IsyFact-konforme System Sonderzeichen in gleicher Weise verarbeitet, wird durchgängig Unicode v4.x in der UTF-8-Codierung verwendet.

[[betriebssystem]]
=== Betriebssystem

Die Standard-Zeichencodierung aller in der <<glossar-Plattform>> verwendeten Betriebssysteme muss einheitlich auf die Verwendung von Unicode v4.x in der UTF-8-Codierung gesetzt werden.

Als Beispiel wird hier das Betriebssystem SUSE Linux Enterprise Server (SLES) 10 betrachtet.
Hier ist die Standard-Zeichencodierung UTF-8. Diese kann über den Konfigurationsparameter

`LC_CTYPE = UTF8`

auch für jeden Benutzer individuell gesetzt werden.

[[oracle-datenbank]]
=== Oracle Datenbank

Die Zeichencodierung aller in der Plattform verwendeten Datenbanken muss ebenfalls einheitlich auf die Verwendung von Unicode v4.x in der UTF-8-Codierung gesetzt werden.

Als Beispiel wird hier die Datenbank Oracle 11g betrachtet.
Oracle unterstützt ab Version 10g Release 2 Unicode v4.0. Oracle empfiehlt <<DGSG>>, neue Datenbanken als Unicode-Datenbanken anzulegen.
Hierzu muss beim CREATE DATABASE die folgende Eigenschaft gesetzt werden:

`CHARACTER SET AL32UTF8`

[[hibernate]]
=== Hibernate

Für Hibernate werden der Unicode-Zeichensatz und die UTF-Zeichencodierung über die beiden Parameter

`hibernate.connection.useUnicode = true`

und

`hibernate.connection.characterEncoding = utf-8`

konfiguriert.
Im Kontext der IsyFact-Standards wird Hibernate nicht direkt, sondern über JPA und Spring genutzt.
Hierzu sind diese Einstellungen in der entsprechenden Konfigurationsdatei `jpa.xml` unter den Properties des Entity Managers wie folgt abzulegen:

[source,xml]
----
<property
    <bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
  <property name="jpaProperties">
    <props>
      …
      <prop key="hibernate.connection.useUnicode">true</prop>
      <prop key="hibernate.connection.characterEncoding">utf-8</prop>
  </property>

</bean>
----

In Eclipse ist an mehreren Stellen die Zeichencodierung zu setzen.
Das erfolgt über den Preferences-Dialog von Eclipse, der über die Menüleiste aufgerufen wird (`Window - Preferences...`).
Folgende Einstellungen sind zu machen:

[source,text]
----
General -> Workspace: Text file encoding - Other = UTF-8
Web and XML -> CSS Files: Encoding = ISO 10646/Unicode(UTF-8)
Web and XML -> HTML Files: Encoding = ISO 10646/Unicode(UTF-8)
Web and XML -> JSP Files: Encoding = ISO 10646/Unicode(UTF-8)
Web and XML -> XML Files: Encoding = ISO 10646/Unicode(UTF-8)
----

WARNING: Diese Einstellungen sind Workspace-spezifisch, d.h. sie müssen für jeden Workspace individuell eingestellt werden.

[[java]]
=== Java

Im Java-Compiler wird die Zeichencodierung der Quelldateien beim Aufruf über den Parameter

`–encoding UTF-8`

gesetzt.
In der JVM wird die Standard-Zeichencodierung beim Aufruf über den Parameter

`-Dfile.encoding=UTF-8`

gesetzt.

[[java-property-dateien]]
=== Java Property-Dateien

Bis zur Java-Version 1.5 werden Property-Dateien grundsätzlich ISO 8859-1 codiert gelesen und geschrieben.
Das ist unabhängig von den Einstellungen des Zeichensatzes in der JVM und im Betriebssystem.
Das Tool native2ascii (Native-to-ASCII Converter, siehe http://docs.oracle.com/javase/1.5.0/docs/tooldocs/windows/native2ascii.html) kann für die Umcodierung von Property-Dateien verwendet werden.

Bei XML-basierten Property-Dateien, können auch andere Zeichencodierungen verwendet werden.

[[maven]]
=== Maven

Der Build erfolgt mit Maven. Hier ist die Zeichencodierung wie folgt zu setzen:

[source, xml]
----
<project>
...
  <build>
    <plugins>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-resources-plugin</artifactId>
...
        <configuration>
          <encoding>UTF-8</encoding>
        </configuration>
      </plugin>
...
      <plugin>
        <artifactId>maven-compiler-plugin</artifactId>
        <configuration>
...
          <compilerArguments>
            <encoding>UTF-8</encoding>
...
          </compilerArguments>
        </configuration>
      </plugin>
...
    </plugins>
...
  </build>
...
  <reporting>
    <plugin>
      <groupId>org.apache.maven.plugins</groupId>
      <artifactId>maven-javadoc-plugin</artifactId>
...
        <configuration>
          <encoding>UTF-8</encoding>
        </configuration>
    </plugin>
...
  </reporting>
...
</project>
----

[[xml]]
=== XML

UTF-8 ist die Standard-Zeichencodierung für XML.
Das wird in der ersten Zeile der XML-Datei wie folgt deklariert:

`<?xml version="1.0" **encoding="UTF-8"**?>`

[[html]]
=== HTML

In HTML wird die Zeichencodierung in den Metadaten des HEAD-Tags wie folgt angegeben:

[source,html]
----
<meta http-equiv="Content-Type"
    content="text/html; charset=utf-8" />
----

Damit dürfen auch keine HTML-Sonderzeichen mehr verwendet werden, sondern nur noch UTF-8-codierte Zeichen.

[[bibliothek-isy-sonderzeichen]]
== Bibliothek „isy-sonderzeichen“

Dieses Kapitel beschreibt die Verwendung des Bausteins `isy-sonderzeichen`.

Der Baustein `isy-sonderzeichen` ist eine Querschnittskomponente, die anderen Anwendungen Services zur Transformation von Zeichenketten zur Verfügung stellt. Die Bibliothek stellt dabei eine feste Anzahl von Transformatoren zur Verfügung, die für eine einheitliche Transformation von Zeichenketten innerhalb der Systemumgebung sorgen.

Im Zuge der Umsetzung der DIN Spezifikation 91 379 wurde `isy-sonderzeichen` erweitert. Um die ursprüngliche Funktionalität zu erhalten,
wurde die Bibliothek in zwei Packages aufgeteilt. Das _stringlatin1_1_ Package enthält die ursprüngliche Funktionalität. Die Umsetzung der
DIN Spezifikation wurde im Package _dinspec91379_ umgesetzt. Die Architektur und Funktionsweise der Komponente wurde im Zuge der
Umsetzung nicht verändert.

[[funktionsweise]]
=== Funktionsweise

Die Transformatoren arbeiten alle nach dem gleichen Schema.
Sie unterscheiden sich nur durch unterschiedliche Tabellen, die zur Zeichentransformation herangezogen werden.

. Alle Zeichen werden gemäß einer Mapping-Tabelle transformiert (Beispiel in <<table-transkription>>).
. Unbekannte oder nicht abbildbare Zeichen werden durch Leerzeichen ersetzt.
. Leerzeichen am Anfang und am Ende der Zeichenkette werden entfernt.
. Zwei aufeinanderfolgende Leerzeichen werden durch ein einzelnes Leerzeichen ersetzt.

Transformatoren müssen in der Regel projektspezifisch entwickelt werden.
Darüber hinaus werden folgende Transformatoren mitgeliefert:

*Identischer Transformator*

Dieser Transformator bildet alle gültigen String.Latin-Zeichen auf sich selber ab.
Der Nutzen dieses Transformators liegt darin, dass alle nicht String.Latin-Zeichen aus der übergebenen Zeichenkette entfernt werden.
Dieser Transformator ermöglicht keine Vorgabe der maximalen Zeichenlänge.

*Transkription Transformator*

Dieser Transformator führt die in <<table-transkription>> dargestellte Transkription durch. Die Transkription ist eine aussprachebasierte
Darstellung der übergebenen Zeichenkette, die mit dem ASCII-Zeichensatz dargestellt werden kann.
Dieser Transformator ermöglicht keine Vorgabe der maximalen Zeichenlänge.

[[einbindung-der-bibliothek-in-eine-anwendung]]
=== Einbindung der Bibliothek in eine Anwendung

Um die Bibliothek in einer Anwendung nutzen zu können, sind zwei Schritte notwendig

* Integration mit Maven und
* Instanziierung der Transformator Factory.

[[integration-mit-maven]]
==== Integration mit Maven

In der POM der Anwendung muss die Abhängigkeit hinzugefügt werden:

[source,xml]
----
<dependency>
  <groupId>de.bund.bva.isyfact</groupId>
  <artifactId>isy-sonderzeichen</artifactId>
  <version><aktueller Version der Bibliothek></version>
</dependency>
----

[[instanziierung-der-transformator-factory]]
==== Instanziierung der Transformator Factory

Die Transformator-Factory und ein konkreter Transformator werden über Spring instanziiert.

[source,xml]
----
<bean id="sonderzeichenTransformatorFactory" class="de.bund.bva.isyfact.sonderzeichen.stringlatin1_1.core.transformation.TransformatorFactory">
  <property name="transformator" ref="sonderzeichenTransformator" >
  <property name="transformationsTabelle" + value="${Pfad_zu_einerzusaetzlichenTabelle}">
</bean>

<bean id="sonderzeichenTransformator" class="de.bund.bva.isyfact.sonderzeichen.stringlatin1_1.core.transformation.impl.IdentischerTransformator">
</bean>
----

In obigem Beispiel wird dabei der Transformator _IdentischerTransformator_ aus der ursprünglichen Umsetzung geladen.
Jeder der Transformatoren setzt bereits eine fest implementierte Transformationstabelle nach einem bestimmten Vorgehen um (siehe <<funktionsweise>>).

Bei der Konfiguration der _TransformatorFactory_ kann die zusätzliche (optionale) Eigenschaft _transformationsTabelle_ dazu genutzt werden, eine weitere Transformationstabelle anzugeben.
Die Regeln in dieser Tabelle überschreiben dabei existierende alte Regeln.
Es findet also eine Ergänzung der existierenden Regeln statt.

Das Vorgehen für die Komponenten der DIN Spezifikation 91 379 ist analog. Es müssen lediglich die Package-Pfade der Klassen aktualisiert werden.

[[schnittstellendefinition]]
=== Schnittstellendefinition

Der Aufruf des Transformators erfolgt über die jeweilige Methode der Transformator Schnittstelle.
Folgende Methoden stehen zur Verfügung:

:desc-table-Transformator-Methoden: Transformator-Methoden
[id="table-Transformator-Methoden",reftext="{table-caption} {counter:tables}"]
.{desc-table-Transformator-Methoden}
[cols=",",options="header",]
|====
|Methode |Parameter
a|
`transformiere`

Transformiert eine Zeichenkette auf der Basis der zugrunde liegenden Transformationstabelle.

Leerzeichen am Anfang und am Ende der Zeichenkette werden entfernt.

Doppelte Leerzeichen innerhalb der Zeichenkette werden zu einem Leerzeichen umgewandelt.

 a|
`String zeichenkette`

Die zu transformierende Zeichenkette

a|
`transformiere`

Transformiert eine Zeichenkette analog der zuvor beschriebenen `transformiere`-Funktion.
Stellt zusätzlich sicher, dass die Zeichenkette nach der Operation die angegebene Länge hat.
Es wird dabei nicht unterschieden, ob die ursprüngliche Zeichenkettenlänge bereits das Maximum überschritten hat oder erst durch eine Transformation die Zeichenkette verlängert wurde.

 a|
`String zeichenkette`

Die zu transformierende Zeichenkette

`int maximaleLaenge`

Die maximale Länge der Zeichenkette

a|
`transformiereOhneTrim`

Transformiert eine Zeichenkette analog der zuvor beschriebenen `transformiere`-Funktion.
Es werden jedoch keine Leerzeichen am Anfang/Ende der übergebenen Zeichenkette entfernt.

 a|
`String zeichenkette`

Die zu transformierende Zeichenkette

a|
`getRegulaererAusdruck`

Gibt den regulären Ausdruck zurück, der alle gültige Zeichenketten beschreibt, deren Zeichen in der jeweiligen Zeichenkategorie aufgeführt sind.

 a|
`String[] kategorieListe`

Eine Liste mit den Zeichenkategorien.
Gültige Werte sind `LETTER, NUMBER, PUNCTUATION, SEPARATOR, SYMBOL, OTHER`.

Die Werte sind der Konstantenklasse `ZeichenKategorie` zu entnehmen.

a|
`getGueltigeZeichen`

Gibt alle gültigen Zeichen des Transformators zurück.

 a|
`String kategorie`

Eine Zeichenkategorie aus `LETTER, NUMBER, PUNCTUATION, SEPARATOR, SYMBOL, OTHER`.

|====

[underline]*Hinweis zur Funktion* [underline]`transformiere`

Die Transformationsfunktion arbeitet die Zeichenkette char für char ab.
Sollte ein Unicode-Character, welcher aus mehreren char Objekten besteht definiert sein (non-BMP character, z.B. I mit angehängtem Circumflex (\\u006C\\u0302), so liefert die Transformationsfunktion das korrekte Ergebnis, kann aber nicht zwischen String.Latin- und Nicht-String.Latin-Zeichen unterscheiden.
So könnten Zeichen außerhalb des Definitionsbereichs (z.B. alle \\u\####\\u0302) der Transformation transformiert werden.

Zur Überprüfung ob eine Zeichenkette innerhalb des für den Transformator gültigen Bereichs liegt, sollte daher die Funktion `getRegulaererAusdruck(String[])` benutzt werden um einen regulären Ausdruck für alle gültigen Zeichen zu erstellen.

[[zulaessige-zeichen-innerhalb-der-isyfact]]
=== Zulässige Zeichen innerhalb der IsyFact

Die im Rahmen der IsyFact zugelassenen Zeichen gliedern sich in Standardzeichen und zusätzliche Zeichen.
Die Standardzeichen müssen von jeder Anwendung immer unterstützt werden.
Die zusätzlichen Zeichen müssen nur unterstützt werden, wenn dies entsprechend vereinbart wurde.
Die Festlegungen für die zulässigen Zeichen orientieren sich an den Festlegungen, die für das Meldewesen getroffen wurden.

Die für die IsyFact zulässigen Zeichen werden im Folgenden aufgeführt. (Siehe Kapitel _Festlegung des Zeichensatzes und der Codierung_ in <<KonzeptUmgangMitSonderzeichen>>)

[[standardzeichen]]
=== Standardzeichen

* Großbuchstaben: A-Z Ä Ö Ü
* Kleinbuchstaben: a-z ä ö ü ß
* Ziffern: 0-9
* **Sonderzeichen**: ' ( ) + , - . / Leerzeichen

[[zusaetzliche-zeichen]]
=== Zusätzliche Zeichen

In <<table-zusaetzliche-zeichen>> sind die Zeichen dargestellt, die zusätzlich unterstützt werden.
Damit die Zeichen in der Spalte „Glyph“ korrekt dargestellt werden, muss ein Font installiert sein, der alle Zeichen unterstützt. (z.B. Code2000, erhältlich unter http://www.code2000.net).

// end::inhalt[]